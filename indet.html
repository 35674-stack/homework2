<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathemind - สรุปคณิตศาสตร์ ม.4</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Sarabun -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #FEC8D8; /* Pastel Pink */
            --accent-color: #FFDFD3; /* Lighter Pastel Pink/Peach */
            --secondary-color: #FEF9F8; /* Very Light Pink Background */
            --text-color: #5D5D5D;
            --white: #fff;
            --shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .main-app {
            padding-bottom: 80px; /* Space for bottom nav */
        }
        
        .hawk-logo { width: 100px; height: 100px; }

        .auth-wrapper {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background: var(--primary-color) url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-48 0c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-48 0c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7z" fill="%23fff" fill-opacity="0.1"/%3E%3C/svg%3E');
        }

        .auth-container {
            max-width: 420px; width: 100%; text-align: center; padding: 1rem;
        }
        .auth-card {
             background-color: var(--white); border-radius: 30px;
             padding: 2.5rem 2rem;
             box-shadow: var(--shadow);
        }
        .form-control {
            border-radius: 20px; border: 1px solid #ddd; padding: 0.75rem 1rem;
            background-color: #FDFDFD;
        }
        .btn-login {
            background-color: var(--primary-color); color: var(--white);
            font-weight: bold; border-radius: 20px; padding: 0.75rem;
            border: none; box-shadow: 0 4px 10px rgba(254, 200, 216, 0.4);
        }
        
        .dashboard-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 1.5rem;
        }
        .profile-pic { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        
        .section-title {
            font-weight: 700;
            font-size: 1.2rem;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-scroll {
            display: flex;
            overflow-x: auto;
            padding: 1rem 1.5rem;
            gap: 1rem;
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .summary-scroll::-webkit-scrollbar { display: none; }

        .topic-card {
            flex: 0 0 140px;
            background-color: var(--white); border-radius: 1.5rem;
            box-shadow: var(--shadow);
            cursor: pointer; border: none;
            padding: 1rem; text-align: center;
            transition: transform 0.2s;
        }
        .topic-card:hover { transform: translateY(-5px); }
        .topic-card img { width: 100%; height: 80px; object-fit: cover; border-radius: 1rem; margin-bottom: 0.5rem; }

        .streak-card {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            border-radius: 1.5rem;
            padding: 1rem; margin: 1.5rem 1.5rem;
            display: flex; align-items: center; justify-content: space-between;
            color: var(--white);
            box-shadow: 0 6px 20px rgba(254, 200, 216, 0.4);
        }
        .streak-fire-mascot { width: 60px; height: 60px; }
        .streak-text strong { font-size: 1.2rem; display: block;}
        .btn-checkin {
            background-color: var(--white);
            color: var(--primary-color);
            border: none;
            border-radius: 20px;
            font-weight: bold;
            padding: 0.5rem 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn-checkin:disabled {
            background-color: #ffffff99;
            color: #fec8d899;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background-color: var(--white);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            display: flex; justify-content: space-around;
            padding: 0.5rem 0;
            z-index: 1000;
        }
        .bottom-nav-item {
            display: flex; flex-direction: column; align-items: center;
            font-size: 0.75rem; color: var(--text-color);
            cursor: pointer;
            border: none; background: none;
        }
        .bottom-nav-item i { font-size: 1.5rem; }
        .bottom-nav-item.active { color: var(--primary-color); }
        
        .app-page {
            display: none; background-color: var(--secondary-color);
            min-height: 100vh;
            animation: fadeIn 0.3s ease-in-out;
            padding-bottom: 80px;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .app-page.active { display: block; }

        .page-header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 1rem;
            display: flex; align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }
        .page-header .btn-back { color: var(--white); font-size: 1.5rem; background: none; border: none; }
        
        .content-container {
            padding: 1.5rem;
            background-color: var(--white);
            margin: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: var(--shadow);
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAAAC1JREFUaEPt2EENgEAMANAlJ34/4dGkMht4Qy7EAYh7naZr2bZt27Zt2/Zt/8wBf94CQRB+MhAAAAAASUVORK5CYII=');
        }

        .large-card {
            background-color: var(--white);
            border-radius: 1.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .large-card:hover { transform: translateY(-5px); }
        .large-card img {
            width: 80px;
            height: 80px;
            border-radius: 1rem;
            margin-right: 1rem;
            object-fit: cover;
        }
    </style>
</head>
<body>

    <div id="loading-spinner" class="d-flex justify-content-center align-items: center" style="height: 100vh;">
        <div class="spinner-border" style="color: var(--primary-color); width: 3rem; height: 3rem;" role="status"><span class="visually-hidden">Loading...</span></div>
    </div>

    <div id="auth-wrapper" class="auth-wrapper" style="display: none;"></div>
    <div id="main-app" style="display: none;"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCzkaoYq5Pmn5vr71FynHWhEfwuC2amsFs",
            authDomain: "mathemind-d8eec.firebaseapp.com",
            databaseURL: "https://mathemind-d8eec-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mathemind-d8eec",
            storageBucket: "mathemind-d8eec.appspot.com",
            messagingSenderId: "799480882790",
            appId: "1:799480882790:web:b25006081480bdefa7"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const contentData = {
            sets: {
                title: "บทที่ 1: เซต",
                summary: `<p><strong>เซต (Set)</strong> คือ อนิยาม ใช้แทนกลุ่มของสิ่งต่างๆ ที่เราสามารถกำหนดสมาชิกได้ชัดเจนว่ามีอะไรอยู่ในกลุ่มบ้าง และเรียกสิ่งที่อยู่ในเซตว่า <strong>สมาชิก (Element)</strong> สัญลักษณ์ที่ใช้แทนการเป็นสมาชิกคือ ∈</p><h5>การเขียนเซต</h5><ol><li><strong>แบบแจกแจงสมาชิก:</strong> เขียนสมาชิกทั้งหมดลงในวงเล็บปีกกา { } คั่นด้วยจุลภาค เช่น เซตของสระในภาษาอังกฤษ A = {a, e, i, o, u} ลำดับของสมาชิกไม่มีความสำคัญและสมาชิกที่ซ้ำกันนับเป็นตัวเดียว</li><li><strong>แบบบอกเงื่อนไข:</strong> ใช้ตัวแปรแทนสมาชิก แล้วบรรยายสมบัติหรือเงื่อนไขของสมาชิกนั้นๆ เช่น B = {x | x เป็นจำนวนเต็มบวกที่น้อยกว่า 5} อ่านว่า "เซตของ x โดยที่ x เป็นจำนวนเต็มบวกที่น้อยกว่า 5"</li></ol><h5>ชนิดของเซต</h5><ul><li><strong>เซตจำกัด (Finite Set):</strong> เซตที่สามารถนับจำนวนสมาชิกได้ เช่น C = {1, 2, 3, 4}</li><li><strong>เซตอนันต์ (Infinite Set):</strong> เซตที่ไม่ใช่เซตจำกัด เช่น เซตของจำนวนนับ N = {1, 2, 3, ...}</li><li><strong>เซตว่าง (Empty/Null Set):</strong> เซตที่ไม่มีสมาชิกเลย เขียนแทนด้วย { } หรือ ∅</li></ul><h5>ความสัมพันธ์ระหว่างเซต</h5><ul><li><strong>สับเซต (Subset, ⊂):</strong> เซต A เป็นสับเซตของ B ก็ต่อเมื่อสมาชิกทุกตัวของ A เป็นสมาชิกของ B</li><li><strong>เพาเวอร์เซต (Power Set, P(A)):</strong> เซตของสับเซตทั้งหมดของ A ถ้า A มีสมาชิก n ตัว P(A) จะมีสมาชิก 2ⁿ ตัว</li></ul><h5>การดำเนินการของเซต</h5><ul><li><strong>ยูเนียน (Union, ∪):</strong> A ∪ B คือเซตที่มีสมาชิกอยู่ใน A หรือ B หรือทั้งสองเซต</li><li><strong>อินเตอร์เซกชัน (Intersection, ∩):</strong> A ∩ B คือเซตที่มีสมาชิกที่อยู่ในทั้ง A และ B</li><li><strong>คอมพลีเมนต์ (Complement, '):</strong> A' คือเซตของสมาชิกที่อยู่ในเอกภพสัมพัทธ์ (U) แต่ไม่อยู่ใน A</li><li><strong>ผลต่าง (Difference, -):</strong> A - B คือเซตของสมาชิกที่อยู่ใน A แต่ไม่อยู่ใน B</li></ul>`,
                exercises: `<ol><li>กำหนดให้ U = {0, 1, 2, ..., 10}, A = {1, 2, 3, 4}, B = {3, 4, 5, 6} และ C = {5, 6, 7, 8} จงหา (A ∪ B) ∩ C</li><li>ถ้า A = {a, b} จงหา P(A)</li><li>จงเขียนเซต D = {x ∈ I | -3 < x ≤ 2} แบบแจกแจงสมาชิก</li><li>จากการสอบถามนักเรียน 100 คน พบว่ามี 50 คนชอบวิชาคณิตศาสตร์, 40 คนชอบวิชาฟิสิกส์, และ 20 คนชอบทั้งสองวิชา จงหาว่ามีนักเรียนกี่คนที่ไม่ชอบทั้งสองวิชานี้เลย</li><li>กำหนดให้ n(A) = 15, n(B) = 20, n(A ∩ B) = 5 จงหา n(A ∪ B)</li></ol>`,
                quiz: [ { q: "ข้อใดคือเซตว่าง", o: ["{0}", "{∅}", "{}", "{x | x ≠ x}"], a: 3 }, { q: "ถ้า A = {1,2} แล้ว Power set ของ A คือข้อใด", o: ["{{1},{2}}", "{∅,{1},{2}}", "{∅,{1},{2},{1,2}}", "{{1,2}}"], a: 2 }, { q: "ถ้า A = {a,b,c}, B = {c,d,e} แล้ว A ∩ B คือข้อใด", o: ["{c}", "{a,b,d,e}", "{a,b,c,d,e}", "{}"], a: 0 }, { q: "n(A∪B) เท่ากับข้อใด", o: ["n(A)+n(B)", "n(A)+n(B)-n(A∩B)", "n(A)+n(B)+n(A∩B)", "n(U)-n(A∩B)"], a: 1 }, { q: "ถ้า A ⊂ B แล้วข้อใดถูกต้อง", o: ["A∩B = B", "A∪B = A", "A-B = ∅", "B' ⊂ A'"], a: 2 }, { q: "กำหนด A={1,{2},3} ข้อใดผิด", o: ["1 ∈ A", "{2} ∈ A", "2 ∈ A", "3 ∈ A"], a: 2 }, { q: "ถ้า A มีสมาชิก 4 ตัว แล้ว P(A) จะมีสมาชิกกี่ตัว", o: ["4", "8", "16", "32"], a: 2 }, { q: "A - B เท่ากับข้อใด", o: ["A ∩ B'", "A' ∩ B", "A ∪ B'", "A' ∪ B"], a: 0 }, { q: "ข้อใดเป็นเซตอนันต์", o: ["เซตของคนบนโลก", "เซตของเม็ดทรายในทะเล", "เซตของจำนวนเต็ม", "เซตของตัวอักษรไทย"], a: 2 }, { q: "ถ้า A∩B = ∅ หมายความว่าอย่างไร", o: ["A=B", "A⊂B", "B⊂A", "A และ B ไม่มีสมาชิกร่วมกัน"], a: 3 }, { q: "สัญลักษณ์ ⊂ แทนอะไร", o: ["เป็นสมาชิกของ", "เป็นสับเซตของ", "ยูเนียน", "อินเตอร์เซกชัน"], a: 1 }, { q: "ถ้า A = {x | x เป็นพยัญชนะในคำว่า 'กรรมกร'} แล้ว n(A) เท่ากับเท่าใด", o: ["5", "4", "3", "2"], a: 2 }, { q: "ถ้า A' = {1,3,5} และ U = {1,2,3,4,5} แล้ว A คือเซตใด", o: ["{1,3,5}", "{2,4}", "{1,2,3,4,5}", "{}"], a: 1 }, { q: "ข้อใดคือการเขียนเซตแบบบอกเงื่อนไขของ E = {2, 3, 5, 7}", o: ["{x | x เป็นจำนวนคี่}", "{x | x เป็นจำนวนเฉพาะ}", "{x | x เป็นจำนวนเฉพาะบวกที่น้อยกว่า 10}", "{x | x เป็นจำนวนนับ}"], a: 2 }, { q: "เซตของ {x | x ∈ I และ x+1=x} คือเซตใด", o: ["{0}", "{1}", "เซตว่าง", "เซตอนันต์"], a: 2 }, { q: "ถ้า n(A)=3, n(B)=5, และ A⊂B แล้ว n(A∪B) คือเท่าใด", o: ["3", "5", "8", "2"], a: 1 }, { q: "ถ้า n(A-B)=10, n(B-A)=5, n(A∩B)=3 แล้ว n(A∪B) คือเท่าใด", o: ["15", "18", "13", "8"], a: 1 }, { q: "เพาเวอร์เซตของเซตว่างมีสมาชิกกี่ตัว", o: ["0", "1", "2", "หาไม่ได้"], a: 1 }, { q: "ข้อใดถูกต้องเกี่ยวกับเซตว่าง", o: ["∅ ∈ {∅}", "∅ ⊂ {∅}", "ทั้งสองข้อถูก", "ไม่มีข้อถูก"], a: 2 }, { q: "ให้ A = {1, 2, 3} และ B = {1, 2, 3, 4} ข้อใดเป็นเท็จ", o: ["A ⊂ B", "A ∪ B = B", "A ∩ B = A", "B - A = {4}"], a: 3 } ]
            },
            real_numbers: {
                title: "บทที่ 2: จำนวนจริง",
                summary: `<p><strong>จำนวนจริง (Real Number)</strong> คือจำนวนทั้งหมดที่สามารถแสดงบนเส้นจำนวนได้ ซึ่งครอบคลุมทั้งจำนวนตรรกยะและจำนวนอตรรกยะ โครงสร้างของระบบจำนวนจริงประกอบด้วยสับเซตต่างๆ ดังนี้</p><ul><li><strong>จำนวนนับ (N):</strong> {1, 2, 3, ...}</li><li><strong>จำนวนเต็ม (I):</strong> {..., -2, -1, 0, 1, 2, ...} ซึ่งรวมจำนวนเต็มบวก, ศูนย์, และจำนวนเต็มลบ</li><li><strong>จำนวนตรรกยะ (Q):</strong> จำนวนที่เขียนในรูปเศษส่วน a/b ได้ โดย a, b เป็นจำนวนเต็ม และ b ≠ 0 (เช่น จำนวนเต็ม, ทศนิยมซ้ำ)</li><li><strong>จำนวนอตรรกยะ (Q'):</strong> จำนวนที่เขียนในรูปเศษส่วนไม่ได้ (เช่น √2, π, e, ทศนิยมไม่ซ้ำไม่รู้จบ)</li></ul><h5>สมบัติของจำนวนจริง</h5><p>ระบบจำนวนจริงมีสมบัติที่สำคัญเกี่ยวกับการบวกและการคูณ ได้แก่:</p><ol><li><strong>สมบัติปิด:</strong> a+b และ ab เป็นจำนวนจริง</li><li><strong>สมบัติการสลับที่:</strong> a+b = b+a และ ab = ba</li><li><strong>สมบัติการเปลี่ยนกลุ่ม:</strong> (a+b)+c = a+(b+c) และ (ab)c = a(bc)</li><li><strong>สมบัติการมีเอกลักษณ์:</strong> เอกลักษณ์การบวกคือ 0 (a+0=a) และเอกลักษณ์การคูณคือ 1 (a×1=a)</li><li><strong>สมบัติการมีอินเวอร์ส:</strong> อินเวอร์สการบวกของ a คือ -a (a+(-a)=0) และอินเวอร์สการคูณของ a คือ a⁻¹ (a×a⁻¹=1)</li><li><strong>สมบัติการแจกแจง:</strong> a(b+c) = ab + ac</li></ol><h5>การแก้สมการและอสมการ</h5><p>การแก้สมการคือการหาค่าของตัวแปรที่ทำให้สมการเป็นจริง ส่วนอสมการคือการหาช่วงของค่าที่ทำให้เป็นจริง โดยอาศัยสมบัติการบวกและคูณเข้าไปทั้งสองข้าง</p><h5>ค่าสัมบูรณ์ (Absolute Value)</h5><p>ค่าสัมบูรณ์ของ a เขียนแทนด้วย |a| คือระยะทางจาก 0 ถึง a บนเส้นจำนวน ดังนั้น |a| ≥ 0 เสมอ</p><p><strong>สมบัติสำคัญ:</strong> |x| = a หมายถึง x = a หรือ x = -a และ |x| < a หมายถึง -a < x < a</p>`,
                exercises: `<ol><li>จงแก้สมการ 5(x + 3) - 2(x - 1) = 20</li><li>จงแก้อสมการ (2x - 1)/3 ≥ 5 และเขียนคำตอบในรูปช่วง</li><li>จงหาเซตคำตอบของสมการ |3x - 4| = 8</li><li>จงหาเซตคำตอบของอสมการ |x + 2| < 5</li><li>ถ้า a*b = 2a + b จงหาค่าของ 3*(4*5)</li><li>จงหาอินเวอร์สการคูณของ √2 - 1</li><li>จงเขียนช่วง (-∞, 3] ∩ [-2, 5) ให้อยู่ในรูปอย่างง่าย</li></ol>`,
                quiz: [ { q: "ข้อใดเป็นจำนวนอตรรกยะ", o: ["√9", "π", "2.5", "0/5"], a: 1 }, { q: "คำตอบของอสมการ x + 5 > 10 คือข้อใด", o: ["x > 5", "x < 5", "x > 15", "x < 15"], a: 0 }, { q: "ค่าของ | -8 | คือเท่าใด", o: ["-8", "8", "0", "หาค่าไม่ได้"], a: 1 }, { q: "เอกลักษณ์การคูณในระบบจำนวนจริงคือข้อใด", o: ["0", "1", "-1", "ไม่มี"], a: 1 }, { q: "อินเวอร์สการบวกของ 5 คือข้อใด", o: ["5", "-5", "1/5", "-1/5"], a: 1 }, { q: "เซตคำตอบของ x² = 16 คือข้อใด", o: ["{4}", "{-4}", "{4, -4}", "{16}"], a: 2 }, { q: "ข้อใดคือคำตอบของ |x| = -3", o: ["{3}", "{-3}", "{3,-3}", "เซตว่าง"], a: 3 }, { q: "ถ้า 2x - 3 < 7 แล้ว x มีค่าเท่าใด", o: ["x < 5", "x > 5", "x < 2", "x > 2"], a: 0 }, { q: "จำนวนในข้อใดเป็นจำนวนตรรกยะทั้งหมด", o: ["√2, π", "0, 1/2, 3", "√3, 1.732", "π, 22/7"], a: 1 }, { q: "สมบัติในข้อใดที่กล่าวว่า a(b+c) = ab+ac", o: ["การสลับที่", "การเปลี่ยนกลุ่ม", "การแจกแจง", "การมีอินเวอร์ส"], a: 2 }, { q: "ช่วง [2, 5) หมายถึงข้อใด", o: ["{x | 2 < x < 5}", "{x | 2 ≤ x ≤ 5}", "{x | 2 ≤ x < 5}", "{x | 2 < x ≤ 5}"], a: 2 }, { q: "ค่าของ |3 - 5| + |-2| คือเท่าใด", o: ["0", "2", "4", "6"], a: 2 }, { q: "อินเวอร์สการคูณของ 2/3 คือข้อใด", o: ["-2/3", "3/2", "-3/2", "1"], a: 1 }, { q: "ถ้า |x - 1| ≤ 4 แล้วข้อใดถูกต้อง", o: ["-5 ≤ x ≤ 3", "-3 ≤ x ≤ 5", "x ≤ 5", "x ≥ -3"], a: 1 }, { q: "ข้อใดไม่ใช่จำนวนเต็ม", o: ["-10", "√16", "0", "1.5"], a: 3 }, { q: "จำนวนเฉพาะที่อยู่ระหว่าง 10 และ 20 มีกี่จำนวน", o: ["3", "4", "5", "6"], a: 1 }, { q: "ถ้า (x-2)(x+3) = 0 แล้วผลบวกของคำตอบคือเท่าใด", o: ["1", "-1", "5", "-5"], a: 1 }, { q: "เซตของจำนวนนับเป็นสับเซตของเซตใด", o: ["จำนวนอตรรกยะ", "จำนวนเต็ม", "จำนวนลบ", "เซตว่าง"], a: 1 }, { q: "ค่าประมาณของ π คือข้อใด", o: ["3.14", "22/7", "เป็นจำนวนอตรรกยะ", "ทุกข้อที่กล่าวมา"], a: 3 }, { q: "ข้อใดคือการแยกตัวประกอบของ x² - 5x + 6", o: ["(x-6)(x+1)", "(x+6)(x-1)", "(x-2)(x-3)", "(x+2)(x+3)"], a: 2 } ]
            },
            logic: {
                title: "บทที่ 3: ตรรกศาสตร์",
                summary: `<p><strong>ตรรกศาสตร์ (Logic)</strong> เป็นวิชาที่ว่าด้วยการให้เหตุผลอย่างสมเหตุสมผล โดยศึกษาจากโครงสร้างของประโยค</p><p><strong>ประพจน์ (Proposition)</strong> คือ ประโยคบอกเล่าหรือปฏิเสธที่มีค่าความจริง (Truth Value) เป็น <strong>จริง (True, T)</strong> หรือ <strong>เท็จ (False, F)</strong> อย่างใดอย่างหนึ่งเท่านั้น ประโยคคำถาม คำสั่ง ขอร้อง อุทาน ไม่เป็นประพจน์</p><h5>ตัวเชื่อมประพจน์ (Logical Connectives)</h5><p>ใช้สร้างประพจน์เชิงประกอบจากประพจน์ย่อยๆ:</p><ul><li><strong>นิเสธ (~):</strong> "ไม่" มีค่าความจริงตรงข้ามกับประพจน์เดิม</li><li><strong>และ (∧):</strong> "and" เป็นจริงเมื่อทุกประพจน์ย่อยเป็นจริงเท่านั้น</li><li><strong>หรือ (∨):</strong> "or" เป็นเท็จเมื่อทุกประพ-จน์ย่อยเป็นเท็จเท่านั้น</li><li><strong>ถ้า...แล้ว... (→):</strong> "if...then..." เป็นเท็จกรณีเดียวคือ เหตุ(หน้า)เป็นจริง แต่ผล(หลัง)เป็นเท็จ</li><li><strong>ก็ต่อเมื่อ (↔):</strong> "if and only if" เป็นจริงเมื่อประพจน์ย่อยมีค่าความจริงเหมือนกัน</li></ul><h5>การสมมูลกันของประพจน์</h5><p>ประพจน์สองรูปแบบจะสมมูลกัน (≡) ก็ต่อเมื่อมีค่าความจริงเหมือนกันทุกกรณี เช่น p → q ≡ ~p ∨ q</p><h5>สัจนิรันดร์ (Tautology)</h5><p>คือ รูปแบบของประพจน์ที่มีค่าความจริงเป็นจริงทุกกรณี ไม่ว่าประพจน์ย่อยจะมีค่าความจริงเป็นอะไรก็ตาม วิธีตรวจสอบทำได้โดยสร้างตารางค่าความจริง หรือใช้การหาข้อขัดแย้ง</p><h5>ตัวบ่งปริมาณ (Quantifiers)</h5><p>ใช้ในประโยคเปิดเพื่อทำให้เป็นประพจน์</p><ul><li><strong>For all (∀x):</strong> "สำหรับ x ทุกตัว" จะเป็นจริงเมื่อ x ทุกค่าในเอกภพสัมพัทธ์ทำให้ประโยคเปิดเป็นจริง</li><li><strong>For some (∃x):</strong> "สำหรับ x บางตัว" จะเป็นจริงเมื่อมี x อย่างน้อยหนึ่งค่าในเอกภพสัมพัทธ์ที่ทำให้ประโยคเปิดเป็นจริง</li></ul>`,
                exercises: `<ol><li>จงสร้างตารางค่าความจริงของประพจน์ (p → q) ↔ (~p ∨ q)</li><li>จงตรวจสอบว่า p → (q → p) เป็นสัจนิรันดร์หรือไม่</li><li>จงหานิเสธของประพจน์ "ถ้าฝนตกแล้วรถติด"</li><li>กำหนดให้ U = {1, 2, 3} จงหาค่าความจริงของ ∀x[x > 0] และ ∃x[x² = 5]</li><li>จงตรวจสอบว่า (p ∧ q) → r สมมูลกับ p → (q → r) หรือไม่</li><li>ถ้าประพจน์ (p ∧ ~q) → (r ∨ s) มีค่าความจริงเป็นเท็จ จงหาค่าความจริงของ p, q, r, s</li></ol>`,
                quiz: [ { q: "ถ้า p เป็นจริง q เป็นเท็จ แล้ว p ∧ q มีค่าความจริงเป็นอะไร", o: ["จริง", "เท็จ"], a: 1 }, { q: "ข้อใดไม่เป็นประพจน์", o: ["1+1=2", "ดวงอาทิตย์ขึ้นทางทิศตะวันตก", "กรุณาปิดประตู", "ประเทศไทยอยู่ในทวีปเอเชีย"], a: 2 }, { q: "ประพจน์ p → q จะเป็นเท็จในกรณีใด", o: ["p จริง, q จริง", "p จริง, q เท็จ", "p เท็จ, q จริง", "p เท็จ, q เท็จ"], a: 1 }, { q: "นิเสธของ 'p ∧ q' คือข้อใด", o: ["~p ∧ ~q", "~p ∨ ~q", "p ∨ q", "~p → ~q"], a: 1 }, { q: "ประพจน์ p ∨ ~p เป็นประพจน์ชนิดใด", o: ["สัจนิรันดร์", "ข้อขัดแย้ง", "อาจเป็นจริงหรือเท็จก็ได้", "ไม่ใช่ประพจน์"], a: 0 }, { q: "ถ้า p → q เป็นเท็จ แล้ว p ↔ q เป็นอะไร", o: ["จริง", "เท็จ", "สรุปไม่ได้"], a: 1 }, { q: "ข้อใดสมมูลกับ p → q", o: ["q → p", "~q → ~p", "p ∧ ~q", "~p ∧ q"], a: 1 }, { q: "กำหนด U = {1,2,3} ข้อใดเป็นจริง", o: ["∀x[x > 1]", "∃x[x < 1]", "∀x[x² > 0]", "∃x[x+1=5]"], a: 2 }, { q: "นิเสธของ ∀x[P(x)] คือข้อใด", o: ["∀x[~P(x)]", "∃x[~P(x)]", "∃x[P(x)]", "~∀x[P(x)]"], a: 1 }, { q: "ถ้า (p ∨ q) → r เป็นเท็จ แล้วค่าความจริงของ p, q, r คืออะไร", o: ["T, T, F", "T, F, F", "F, F, F", "เป็นไปได้มากกว่า 1 ข้อ"], a: 3 }, { q: "ประโยค 'x + 5 = 10' เป็นอะไร", o: ["ประพจน์", "ประโยคเปิด", "สัจนิรันดร์", "ข้อขัดแย้ง"], a: 1 }, { q: "ถ้า p เป็นเท็จ q เป็นจริง แล้ว (p ↔ q) ∨ q มีค่าความจริงเป็นอะไร", o: ["จริง", "เท็จ"], a: 0 }, { q: "ตัวเชื่อมใดเป็นจริงเมื่อค่าความจริงของประพจน์ย่อยต่างกัน", o: ["∧", "∨", "→", "↔"], a: 3 }, { q: "ถ้า p แทน 'ฉันขยัน' และ q แทน 'ฉันสอบผ่าน' ข้อใดแทน 'ถ้าฉันไม่ขยันแล้วฉันสอบไม่ผ่าน'", o: ["p → q", "~p → ~q", "~q → ~p", "p ↔ q"], a: 1 }, { q: "ข้อใดเป็นข้อขัดแย้ง (Contradiction)", o: ["p ∨ ~p", "p → p", "p ∧ ~p", "p ↔ p"], a: 2 }, { q: "กำหนด U เป็นเซตของจำนวนนับ ข้อใดเป็นเท็จ", o: ["∃x[x+1=x]", "∀x[x > 0]", "∃x[x เป็นจำนวนเฉพาะ]", "∀x[x+1 > x]"], a: 0 }, { q: "ถ้า p ↔ q เป็นจริง ข้อใดสรุปได้ถูกต้อง", o: ["p และ q จริงทั้งคู่", "p และ q เท็จทั้งคู่", "p และ q มีค่าความจริงเหมือนกัน", "p และ q มีค่าความจริงต่างกัน"], a: 2 }, { q: "นิเสธของ ∃x[x < 0] คือข้อใด", o: ["∃x[x ≥ 0]", "∀x[x > 0]", "∀x[x ≥ 0]", "∃x[x > 0]"], a: 2 }, { q: "ถ้า 'p และ q' เป็นจริง แล้ว 'p หรือ q' เป็นอะไร", o: ["จริง", "เท็จ", "สรุปไม่ได้"], a: 0 }, { q: "การอ้างเหตุผลจะสมเหตุสมผลเมื่อใด", o: ["เมื่อเหตุทุกข้อเป็นจริง", "เมื่อผลเป็นจริง", "เมื่อประพจน์ที่เชื่อมเหตุกับผลเป็นสัจนิรันดร์", "เมื่อเหตุและผลมีค่าความจริงเหมือนกัน"], a: 2 } ]
            }
        };

        const loadingSpinner = document.getElementById('loading-spinner');
        const authWrapper = document.getElementById('auth-wrapper');
        const mainApp = document.getElementById('main-app');
        
        // --- App State ---
        let currentQuizData = null;
        let currentQuestionIndex = 0;
        let score = 0;

        // --- Render Functions ---
        function renderAuthView() {
            authWrapper.innerHTML = `
            <div class="auth-container">
                <svg class="hawk-logo mb-3" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g fill="#FEC8D8"><path d="M100 20C55.8 20 20 55.8 20 100s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80zm0 140c-33.1 0-60-26.9-60-60s26.9-60 60-60 60 26.9 60 60-26.9 60-60 60z"/><path d="M108.3 60.8c-2.3-2.3-5.5-3.6-8.8-3.6s-6.5 1.3-8.8 3.6c-4.9 4.9-4.9 12.8 0 17.7l8.8 8.8 8.8-8.8c4.9-4.9 4.9-12.8 0-17.7zM125 100l-25 25-25-25h50zM80 120l20 20 20-20H80z"/></g></svg>
                <h2 class="mb-3" style="font-weight: 700;">ยินดีต้อนรับ</h2>
                <div id="auth-card-container"></div>
            </div>`;
            renderLoginCard();
        }

        function renderLoginCard() {
            document.getElementById('auth-card-container').innerHTML = `
                <div class="auth-card">
                    <h4 class="mb-4">Log in</h4>
                    <form id="login-form">
                        <div class="mb-3 text-start"><label for="login-email" class="form-label small">Email</label><input type="email" class="form-control" id="login-email" required></div>
                        <div class="mb-3 text-start"><label for="login-password" class="form-label small">Password</label><input type="password" class="form-control" id="login-password" required></div>
                        <div id="login-error" class="alert alert-danger" style="display: none;"></div>
                        <button type="submit" class="btn btn-login w-100 mt-2">Login</button>
                    </form>
                    <p class="mt-3 small">ยังไม่มีบัญชี? <a href="#" id="show-register-view">สมัครสมาชิก</a></p>
                </div>
            `;
            document.getElementById('show-register-view').addEventListener('click', (e) => {
                e.preventDefault();
                renderRegisterCard();
            });
            document.getElementById('login-form').addEventListener('submit', handleLogin);
        }

        function renderRegisterCard() {
             document.getElementById('auth-card-container').innerHTML = `
                <div class="auth-card">
                    <h4 class="mb-4">Register</h4>
                    <form id="register-form">
                        <div class="mb-3 text-start"><label for="register-email" class="form-label small">Email</label><input type="email" class="form-control" id="register-email" required></div>
                        <div class="mb-3 text-start"><label for="register-password" class="form-label small">Password</label><input type="password" class="form-control" id="register-password" required></div>
                        <div id="register-error" class="alert alert-danger" style="display: none;"></div>
                        <button type="submit" class="btn btn-login w-100 mt-2">Register</button>
                    </form>
                    <p class="mt-3 small">มีบัญชีอยู่แล้ว? <a href="#" id="show-login-view">เข้าสู่ระบบ</a></p>
                </div>
            `;
            document.getElementById('show-login-view').addEventListener('click', (e) => {
                e.preventDefault();
                renderLoginCard();
            });
            document.getElementById('register-form').addEventListener('submit', handleRegister);
        }
        
        function renderAppShell(user) {
            mainApp.innerHTML = `
                <div id="dashboard-page" class="app-page main-app active"></div>
                <div id="profile-page" class="app-page profile-view"></div>
                <div id="content-page" class="app-page content-view"></div>

                <nav class="bottom-nav">
                    <button class="bottom-nav-item active" id="nav-dashboard">
                        <i class="bi bi-house-fill"></i>
                        <span>หน้าหลัก</span>
                    </button>
                    <button class="bottom-nav-item" id="nav-profile">
                        <i class="bi bi-person-fill"></i>
                        <span>โปรไฟล์</span>
                    </button>
                </nav>
            `;
            renderDashboard(user);
            setupNavListeners(user);
        }

        async function renderDashboard(user) {
            document.getElementById('dashboard-page').innerHTML = `
                <div class="dashboard-header">
                    <div>
                        <small>Welcome back,</small>
                        <h5 class="mb-0">${user.email.split('@')[0]}</h5>
                    </div>
                    <img src="https://placehold.co/40x40/FEC8D8/FFF?text=${user.email.charAt(0).toUpperCase()}" class="profile-pic" alt="Profile">
                </div>

                <div id="streak-card-container"></div>
                
                <div class="section-title mt-4">
                    <span>ชีทสรุป</span>
                    <a href="#" class="small">ดูทั้งหมด</a>
                </div>
                <div class="summary-scroll">
                    <div class="topic-card" data-topic="sets">
                        <img src="https://placehold.co/140x80/FEF9F8/FEC8D8?text=เซต" alt="Sets">
                        <strong>เซต</strong>
                    </div>
                    <div class="topic-card" data-topic="real_numbers">
                        <img src="https://placehold.co/140x80/FEF9F8/FEC8D8?text=จำนวนจริง" alt="Real Numbers">
                        <strong>จำนวนจริง</strong>
                    </div>
                    <div class="topic-card" data-topic="logic">
                        <img src="https://placehold.co/140x80/FEF9F8/FEC8D8?text=ตรรกศาสตร์" alt="Logic">
                        <strong>ตรรกศาสตร์</strong>
                    </div>
                </div>

                <div class="section-title mt-4">
                    <span>แบบฝึกหัด & แบบทดสอบ</span>
                </div>
                <div class="px-3 mt-3">
                    <div class="large-card" data-topic="sets" data-view="exercises">
                        <img src="https://placehold.co/80x80/E3F2FD/1E88E5?text=แบบฝึกหัด" alt="Exercises">
                        <div>
                            <strong>แบบฝึกหัด</strong>
                            <p class="small text-muted mb-0">ฝึกฝนโจทย์เพื่อความเข้าใจ</p>
                        </div>
                    </div>
                    <div class="large-card" data-topic="sets" data-view="quiz">
                        <img src="https://placehold.co/80x80/FCE4EC/E91E63?text=แบบทดสอบ" alt="Quiz">
                        <div>
                            <strong>แบบทดสอบ</strong>
                            <p class="small text-muted mb-0">ทดสอบความรู้หลังเรียน</p>
                        </div>
                    </div>
                </div>
            `;
            
            await handleDailyCheckin(user);

            document.querySelectorAll('.topic-card, .large-card').forEach(card => {
                card.addEventListener('click', () => {
                    const topicId = card.dataset.topic;
                    const view = card.dataset.view || 'summary';
                    renderContentPage(topicId, view);
                    showPage('content-page');
                });
            });
        }

        async function renderProfilePage(user) {
            const userCheckinRef = ref(db, `users/${user.uid}/checkin`);
            let checkinData = { streak: 0, lastCheckin: '' };
            let profileError = null;

            try {
                const snapshot = await get(userCheckinRef);
                if (snapshot.exists()) {
                    checkinData = snapshot.val();
                }
            } catch (error) {
                console.error("Firebase Read Error in renderProfilePage:", error);
                profileError = "ไม่สามารถโหลดข้อมูลได้";
                console.warn("This might be due to your Firebase Realtime Database security rules. Make sure authenticated users can read their own data under the '/users/$uid' path.");
            }

            document.getElementById('profile-page').innerHTML = `
                <div class="page-header">
                    <h5 class="mb-0">โปรไฟล์ของฉัน</h5>
                </div>
                <div class="d-flex flex-column align-items-center p-4">
                    <img src="https://placehold.co/100x100/FEC8D8/FFF?text=${user.email.charAt(0).toUpperCase()}" class="profile-pic" style="width:100px; height:100px; margin-bottom: 1rem;" alt="Profile">
                    <h5 class="mb-1">${user.email.split('@')[0]}</h5>
                    <p class="text-muted">${user.email}</p>
                    <div class="streak-card w-100 mt-3" style="${profileError ? 'background: #6c757d;' : ''}">
                        ${profileError ? `
                            <div class="text-center w-100">
                                <strong>เกิดข้อผิดพลาด</strong>
                                <span class="small d-block">${profileError}</span>
                            </div>
                        ` : `
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='60px' height='60px'%3E%3Cpath d='M12.001 2.5c-4.962 0-9 3.585-9 8.025 0 2.21.905 4.353 2.596 5.922L6 21.5h12l.404-5.053c1.69-1.569 2.596-3.712 2.596-5.922 0-4.44-4.038-8.025-9-8.025zm0 1.5c3.815 0 7.5 3.015 7.5 6.525 0 1.956-.814 3.75-2.22 5.078l-.33.308.27 3.39H8.78l.27-3.39-.33-.308C7.314 17.805 6.5 16 6.5 14.025c0-3.51 3.685-6.525 7.5-6.525z'/%3E%3Cpath d='M12 7.5c-1.105 0-2 .895-2 2s.895 2 2 2 2-.895 2-2-.895-2-2-2z'/%3E%3C/svg%3E" class="streak-fire-mascot" alt="Fire Mascot">
                            <div class="text-end">
                                <strong>${checkinData.streak || 0} วัน</strong>
                                <span class="small">เรียนติดต่อกัน</span>
                            </div>
                        `}
                    </div>
                     <button id="logout-button" class="btn btn-danger mt-4">ออกจากระบบ</button>
                </div>
            `;
            document.getElementById('logout-button').addEventListener('click', () => signOut(auth));
        }

        function renderContentPage(topicId, initialView = 'summary') {
             const data = contentData[topicId];
             document.getElementById('content-page').innerHTML = `
                <div class="page-header">
                    <button class="btn-back"><i class="bi bi-arrow-left"></i></button>
                    <h5 class="mb-0 ms-3">${data.title}</h5>
                </div>
                <div class="p-3">
                     <ul class="nav nav-pills nav-fill mb-3" id="contentTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link ${initialView === 'summary' ? 'active' : ''}" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary-content" type="button" role="tab">สรุป</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link ${initialView === 'exercises' ? 'active' : ''}" id="exercises-tab" data-bs-toggle="tab" data-bs-target="#exercises-content" type="button" role="tab">แบบฝึกหัด</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link ${initialView === 'quiz' ? 'active' : ''}" id="quiz-tab" data-bs-toggle="tab" data-bs-target="#quiz-content" type="button" role="tab">แบบทดสอบ</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="contentTabContent">
                        <div class="tab-pane fade ${initialView === 'summary' ? 'show active' : ''}" id="summary-content" role="tabpanel">
                            <div class="content-container">${data.summary}</div>
                        </div>
                        <div class="tab-pane fade ${initialView === 'exercises' ? 'show active' : ''}" id="exercises-content" role="tabpanel">
                            <div class="content-container">${data.exercises}</div>
                        </div>
                        <div class="tab-pane fade ${initialView === 'quiz' ? 'show active' : ''}" id="quiz-content" role="tabpanel">
                            <div class="content-container" id="quiz-container"></div>
                        </div>
                    </div>
                </div>
             `;
            document.querySelector('#content-page .btn-back').addEventListener('click', () => showPage('dashboard-page'));
            
            currentQuizData = data.quiz;
            startQuiz();
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            const quizContainer = document.getElementById('quiz-container');
            if (!quizContainer) return;

            if (currentQuestionIndex < currentQuizData.length) {
                const q = currentQuizData[currentQuestionIndex];
                let optionsHtml = q.o.map((option, index) => 
                    `<button class="btn btn-outline-primary w-100 my-2 text-start" data-index="${index}">${option}</button>`
                ).join('');

                quizContainer.innerHTML = `
                    <h6>คำถาม ${currentQuestionIndex + 1}/${currentQuizData.length}</h6>
                    <p>${q.q}</p>
                    <div id="quiz-options">${optionsHtml}</div>
                    <div id="quiz-feedback" class="mt-3"></div>
                `;

                document.querySelectorAll('#quiz-options button').forEach(button => {
                    button.addEventListener('click', handleAnswer);
                });
            } else {
                quizContainer.innerHTML = `
                    <div class="text-center">
                        <h4>ทำแบบทดสอบเสร็จแล้ว!</h4>
                        <p>คุณได้คะแนน ${score} จาก ${currentQuizData.length} คะแนน</p>
                        <button class="btn btn-primary" id="restart-quiz-button">ทำอีกครั้ง</button>
                    </div>
                `;
                document.getElementById('restart-quiz-button').addEventListener('click', startQuiz);
            }
        }

        function handleAnswer(e) {
            const selectedIndex = parseInt(e.target.dataset.index);
            const correctIndex = currentQuizData[currentQuestionIndex].a;

            document.querySelectorAll('#quiz-options button').forEach(btn => {
                btn.disabled = true;
                const index = parseInt(btn.dataset.index);
                if(index === correctIndex) {
                    btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-success');
                } else if (index === selectedIndex) {
                     btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-danger');
                }
            });

            if (selectedIndex === correctIndex) {
                score++;
                document.getElementById('quiz-feedback').innerHTML = `<div class="alert alert-success">ถูกต้อง!</div>`;
            } else {
                document.getElementById('quiz-feedback').innerHTML = `<div class="alert alert-danger">ผิด! คำตอบที่ถูกต้องคือ: ${currentQuizData[currentQuestionIndex].o[correctIndex]}</div>`;
            }

            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 2000);
        }

        async function handleDailyCheckin(user) {
            const streakContainer = document.getElementById('streak-card-container');
            if (!streakContainer) return;

            const today = new Date();
            const todayStr = today.toISOString().slice(0, 10);
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().slice(0, 10);

            const userCheckinRef = ref(db, `users/${user.uid}/checkin`);
            let checkinData = { streak: 0, lastCheckin: '' };

            try {
                const snapshot = await get(userCheckinRef);
                if(snapshot.exists()){
                    checkinData = snapshot.val();
                }
            } catch (error) {
                console.error("Firebase Read Error in handleDailyCheckin:", error);
                console.warn("This is likely due to your Firebase Realtime Database security rules. Make sure authenticated users can read their own data under the '/users/$uid' path.");
                streakContainer.innerHTML = `
                    <div class="streak-card" style="background: #6c757d;">
                        <div class="text-center w-100">
                            <strong>เกิดข้อผิดพลาด</strong>
                            <span class="small d-block">ไม่สามารถโหลดข้อมูล Streak ได้</span>
                        </div>
                    </div>`;
                return; // Exit the function if we can't read data
            }

            const hasCheckedInToday = checkinData.lastCheckin === todayStr;

            streakContainer.innerHTML = `
                <div class="streak-card">
                    <img src="data:image/svg+xml,%3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 122.88 119.52'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23ffc107;%7D.cls-1,.cls-2,.cls-3%7Bstroke:%23231f20;stroke-miterlimit:10;%7D.cls-2%7Bfill:%23fff;%7D.cls-3%7Bfill:%23f44336;%7D%3C/style%3E%3C/defs%3E%3Cpath class='cls-3' d='M83,11.23C50.33-11,13.88,14.24,14.2,53.4c.1,12.2,4.68,23,12.39,30.34-1.29,4.48-2.52,8.81-4,13.29,6.5-2.4,12.7-5.41,18.89-8.4,4.28,1.61,8.83,2.6,13.51,2.83,32.67,1.6,58.33-25.1,52-56.55-5.28-26.24-31.5-40.83-54-33.66Z'/%3E%3Cpath class='cls-1' d='M89.26,24.3C61.43,6.32,29.93,28.23,30.2,61.46c.09,10.66,4.1,20.09,10.84,26.5-1.12,3.92-2.2,7.7-3.46,11.61,5.69-2.1,11.1-4.73,16.52-7.34,3.74,1.4,7.72,2.27,11.82,2.47,28.56,1.4,51-21.93,45.45-49.44C106.63,42,85.34,28.45,89.26,24.3Z'/%3E%3Cpath class='cls-2' d='M83,11.23C50.33-11,13.88,14.24,14.2,53.4c.1,12.2,4.68,23,12.39,30.34-1.29,4.48-2.52,8.81-4,13.29,6.5-2.4,12.7-5.41,18.89-8.4,4.28,1.61,8.83,2.6,13.51,2.83,32.67,1.6,58.33-25.1,52-56.55-5.28-26.24-31.5-40.83-54-33.66Z' fill='none'/%3E%3C/svg%3E" class="streak-fire-mascot" alt="Fire Mascot">
                    <div class="text-center">
                        <strong>${checkinData.streak || 0} วัน 🔥</strong>
                        <span class="small d-block">เรียนติดต่อกัน</span>
                    </div>
                    <button class="btn-checkin" id="checkin-button" ${hasCheckedInToday ? 'disabled' : ''}>
                        ${hasCheckedInToday ? 'เช็คอินแล้ว' : 'Check in'}
                    </button>
                </div>`;

            if (!hasCheckedInToday) {
                document.getElementById('checkin-button').addEventListener('click', async () => {
                    let newStreak = 1;
                    if (checkinData.lastCheckin === yesterdayStr) {
                        newStreak = (checkinData.streak || 0) + 1;
                    }
                    
                    try {
                        await set(userCheckinRef, {
                            streak: newStreak,
                            lastCheckin: todayStr
                        });
                        await handleDailyCheckin(user); 
                    } catch (error) {
                         console.error("Firebase Write Error in handleDailyCheckin:", error);
                        console.warn("This is likely due to Firebase Realtime Database security rules. Make sure authenticated users can write to their own data under the '/users/$uid' path.");
                        const checkinButton = document.getElementById('checkin-button');
                        if(checkinButton) {
                            checkinButton.textContent = 'Error!';
                            checkinButton.disabled = true;
                        }
                    }
                });
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.app-page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
            if (pageId === 'dashboard-page') {
                document.getElementById('nav-dashboard').classList.add('active');
            } else if (pageId === 'profile-page') {
                document.getElementById('nav-profile').classList.add('active');
            }
        }

        const handleLogin = (e) => { e.preventDefault(); signInWithEmailAndPassword(auth, e.target['login-email'].value, e.target['login-password'].value).catch(err => { document.getElementById('login-error').textContent = 'อีเมลหรือรหัสผ่านไม่ถูกต้อง'; document.getElementById('login-error').style.display = 'block'; }); };
        const handleRegister = (e) => { e.preventDefault(); createUserWithEmailAndPassword(auth, e.target['register-email'].value, e.target['register-password'].value).catch(err => { document.getElementById('register-error').textContent = 'เกิดข้อผิดพลาด: ' + err.message; document.getElementById('register-error').style.display = 'block'; }); };
        
        function setupNavListeners(user) {
            document.getElementById('nav-dashboard').addEventListener('click', () => showPage('dashboard-page'));
            document.getElementById('nav-profile').addEventListener('click', () => {
                renderProfilePage(user);
                showPage('profile-page');
            });
        }
        
        onAuthStateChanged(auth, (user) => {
            loadingSpinner.style.display = 'none';
            if (user) {
                mainApp.style.display = 'block';
                authWrapper.style.display = 'none';
                renderAppShell(user);
            } else {
                mainApp.style.display = 'none';
                authWrapper.style.display = 'flex';
                renderAuthView();
            }
        });

    </script>
</body>
</html>
```

### **คำแนะนำในการแก้ไขปัญหา "Permission Denied"**

โค้ดที่ผมแก้ไขไปจะช่วยแสดงข้อผิดพลาดในหน้าแอปให้คุณทราบ แต่การแก้ไขที่ถาวรและถูกต้องที่สุดคือการเข้าไปตั้งค่า **Security Rules** ในโปรเจกต์ Firebase ของคุณครับ

**ขั้นตอน:**

1.  ไปที่ **Firebase Console** ของโปรเจกต์ Mathemind
2.  จากเมนูด้านซ้าย ไปที่ **Build > Realtime Database**
3.  คลิกที่แท็บ **Rules** (กฎ)
4.  ลบกฎเดิมทั้งหมด แล้วคัดลอกโค้ดด้านล่างนี้ไปวางแทน:

    ```json
    {
      "rules": {
        "users": {
          "$uid": {
            ".read": "auth != null && auth.uid === $uid",
            ".write": "auth != null && auth.uid === $uid"
          }
        }
      }
    }
    

